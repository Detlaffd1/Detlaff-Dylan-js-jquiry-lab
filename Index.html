<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>JS + jQuery Component Lab</title>
  <style>
    :root { --brand:#3a3b78; --accent:#ff66c4; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; line-height:1.55; margin:20px; color:#000; }
    .wrap { max-width:900px; margin:0 auto; }
    .row { display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .card { border:1px solid #eee; border-radius:10px; padding:12px; margin:12px 0; }
    button { background:var(--brand); color:#fff; border:0; padding:10px 14px; border-radius:8px; cursor:pointer; }
    button:hover { background:var(--accent); }
    button:focus { outline:3px solid #111; outline-offset:2px; }
    .flash { box-shadow: 0 0 0 4px #ff66c450; transition: box-shadow .3s ease; }
    [role="status"] { position:absolute; left:-9999px; }
    #feedback { margin-top:8px; font-weight:bold; display:none; }
    #laps li { background:#f1f1f1; padding:6px; margin:4px 0; border-radius:4px; color:#000; }
  </style>
</head>
<body>
  <main class="wrap">
    <h1>JavaScript + jQuery Component Lab</h1>
    <div id="live" role="status" aria-live="polite"></div>

    <section class="card" id="comp1">
      <h2>Quiz Deck</h2>
      <div id="comp1Root"></div>
    </section>

    <section class="card" id="comp2">
      <h2>Stopwatch & Laps</h2>
      <div id="comp2Root"></div>
    </section>

    <section class="card">
      <h2>jQuery Demo Controls</h2>
      <p>These buttons must use jQuery to enhance the page (example provided).</p>
      <div class="row">
        <button id="jqToggle">Toggle Effects Panel</button>
        <button id="jqFlash">Flash Header</button>
      </div>
      <div id="effectsPanel" class="card" style="display:none; margin-top:10px;">
        <p>Hello from the jQuery effects panel!</p>
      </div>
    </section>

    <section class="card">
      <h2>About this page</h2>
      <p>This page implements Track A (Quiz Deck) and Track D (Stopwatch & Laps). Arrays store quiz questions and lap times, functions handle rendering and logic, jQuery is used for effects, and full keyboard accessibility is included.</p>
    </section>
  </main>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <script>
    const $qs = (sel, root=document) => root.querySelector(sel);
    const say = (msg) => { $qs('#live').textContent = msg; };

    const QUIZ = [
      { q: "JS runs primarily in the _____.", choices: ["database","browser","router"], answer: 1 },
      { q: "DOM lets JS change the pageâ€™s _____.", choices: ["network","structure","battery"], answer: 1 }
    ];

    function renderQuiz(rootId, items = QUIZ) {
      const root = $qs('#' + rootId);
      let i = 0, score = 0;

      root.innerHTML = `
        <p id="q"></p>
        <div id="choices" class="row"></div>
        <p id="feedback"></p>
        <p>Score: <span id="score">0</span></p>`;

      const qEl = $qs('#q', root);
      const cEl = $qs('#choices', root);
      const scoreEl = $qs('#score', root);
      const feedbackEl = $qs('#feedback', root);

      function paint() {
        const item = items[i];
        qEl.textContent = (i+1)+". "+item.q;
        cEl.innerHTML = "";
        item.choices.forEach((text, idx) => {
          const btn = document.createElement('button');
          btn.textContent = text;
          btn.setAttribute('tabindex', 0);
          btn.addEventListener('click', ()=>handleAnswer(idx));
          btn.addEventListener('keydown', e => {
            if(e.key==='Enter'||e.key===' ') handleAnswer(idx);
          });
          cEl.appendChild(btn);
        });
      }

      function handleAnswer(idx) {
        const correct = items[i].answer;
        if(idx === correct) {
          score++; 
          feedbackEl.textContent="Correct!"; feedbackEl.style.color="green";
          $(feedbackEl).fadeIn();
          say("Correct");
        } else {
          feedbackEl.textContent="Incorrect!"; feedbackEl.style.color="red";
          $(feedbackEl).fadeIn();
          say("Incorrect");
        }
        scoreEl.textContent=score;
        setTimeout(()=>$(feedbackEl).fadeOut(),800);
        i = Math.min(i+1, items.length-1);
        paint();
      }

      paint();
    }

    function renderStopwatch(rootId) {
      const root = $qs('#' + rootId);
      root.innerHTML = `
        <h3 id="timeDisplay">00:00.0</h3>
        <div class="row">
          <button id="startBtn">Start</button>
          <button id="lapBtn" disabled>Lap</button>
          <button id="resetBtn" disabled>Reset</button>
        </div>
        <ul id="laps"></ul>`;

      const timeDisplay = $qs('#timeDisplay', root);
      const lapsEl = $qs('#laps', root);
      let elapsed=0, timer=null, laps=[];

      function updateTime() { timeDisplay.textContent=(elapsed/10).toFixed(1).padStart(4,"0"); }
      function renderLaps() { lapsEl.innerHTML = laps.map((lap,i)=>`<li>Lap ${i+1}: ${(lap/10).toFixed(1)}s</li>`).join(""); }

      const startBtn = $qs('#startBtn', root);
      const lapBtn = $qs('#lapBtn', root);
      const resetBtn = $qs('#resetBtn', root);

      function startStop() {
        if(!timer){
          timer = setInterval(()=>{ elapsed++; updateTime(); },100);
          lapBtn.disabled=false; resetBtn.disabled=false;
          startBtn.textContent="Stop";
        } else {
          clearInterval(timer); timer=null;
          startBtn.textContent="Start";
        }
      }

      startBtn.addEventListener('click', startStop);
      lapBtn.addEventListener('click', ()=>{ laps.push(elapsed); renderLaps(); });
      resetBtn.addEventListener('click', ()=>{
        clearInterval(timer); timer=null; elapsed=0; laps=[];
        updateTime(); renderLaps();
        lapBtn.disabled=true; resetBtn.disabled=true;
        startBtn.textContent="Start";
      });

      document.addEventListener('keydown', e=>{
        if(e.target.tagName==='INPUT' || e.target.tagName==='TEXTAREA') return;
        if(e.key===' ') { e.preventDefault(); startStop(); }
        if(e.key.toLowerCase()==='l') lapBtn.click();
        if(e.key.toLowerCase()==='r') resetBtn.click();
      });
    }

    $(function(){
      $("#jqToggle").on("click", ()=>$("#effectsPanel").slideToggle(180));
      $("#jqFlash").on("click", ()=>$("h1").addClass("flash").fadeOut(120).fadeIn(180).delay(200).queue(function(next){ $(this).removeClass("flash"); next(); }));
    });

    renderQuiz('comp1Root', QUIZ);
    renderStopwatch('comp2Root');
  </script>
</body>
</html>
